{"componentChunkName":"component---src-templates-blog-post-js","path":"/2018/180906_rofi-mpd-client/180906_rofi-mpd-client/","result":{"data":{"site":{"id":"Site","siteMetadata":{"title":"RINotes"}},"markdownRemark":{"id":"0128ea2d-b8e3-5611-b51e-f876412b5e32","excerpt":"タイトルのとおりです。 Repository: rofi-mpd-client   Rofi rofiはi3のようなタイル型ウィンドウマネージャーでよく用いられているランチャーです。 基本的な動作としては、選びたい項目をrofi…","html":"<p>タイトルのとおりです。<br>\nRepository: <a href=\"https://github.com/tonooo71/rofi-mpd-client\">rofi-mpd-client</a>  </p>\n<h2>Rofi</h2>\n<p>rofiはi3のようなタイル型ウィンドウマネージャーでよく用いられているランチャーです。<br>\n基本的な動作としては、選びたい項目をrofiに渡すとリストとして表示され、選択した項目(の文字列)を返すといったものです。  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9151117112fbd6f7cc69e9511ed216c4/b17f8/screenshot180906.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAEDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHmRErQX//EABcQAAMBAAAAAAAAAAAAAAAAAAABERD/2gAIAQEAAQUCrKXUj//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAAMBAAAAAAAAAAAAAAAAAAABMSD/2gAIAQEABj8CpXn/xAAcEAACAQUBAAAAAAAAAAAAAAAAAREQITFBkVH/2gAIAQEAAT8hk26SCXr6PNFtXP/aAAwDAQACAAMAAAAQky//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QbH//xAAcEAEAAgEFAAAAAAAAAAAAAAABABFRcdHh8PH/2gAIAQEAAT8QHt92sfY3hyyEEEC2NUW3ln//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screenshot180906\"\n        title=\"Screenshot180906\"\n        src=\"/static/9151117112fbd6f7cc69e9511ed216c4/1c72d/screenshot180906.jpg\"\n        srcset=\"/static/9151117112fbd6f7cc69e9511ed216c4/a80bd/screenshot180906.jpg 148w,\n/static/9151117112fbd6f7cc69e9511ed216c4/1c91a/screenshot180906.jpg 295w,\n/static/9151117112fbd6f7cc69e9511ed216c4/1c72d/screenshot180906.jpg 590w,\n/static/9151117112fbd6f7cc69e9511ed216c4/a8a14/screenshot180906.jpg 885w,\n/static/9151117112fbd6f7cc69e9511ed216c4/fbd2c/screenshot180906.jpg 1180w,\n/static/9151117112fbd6f7cc69e9511ed216c4/b17f8/screenshot180906.jpg 1600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>よく使われているのは上のようにプログラムを選択するランチャーとしてですが、上記のように入力を手動で与えることができるので、色々活用方法が考えられます。<br>\n実際にrofiのwikiページにはユーザーが作成したスクリプトがいくつか紹介されています。(<a href=\"https://github.com/DaveDavenport/rofi/wiki/User-scripts\">User scripts</a>)  </p>\n<p>今回作ったMPDのクライアントも2つ紹介されているのですが、自分がよく使う機能だったり欲しい機能だったりがなかったりしたので、作ってみることにしました。<br>\n最初は例のごとくシェルスクリプトで作ろうと思ったのですが、挫折したのでおとなしくpython3で記述しました。<br>\nMPDへアクセスするために上記のスクリプトではいずれも<code class=\"language-text\">mpc</code>というCLIクライアントを利用していたのですが、いちいちsubprocessモジュールで呼び出すのもなんかなあって感じだったので、Pythonのモジュールないか探していたらありました。<br>\n<code class=\"language-text\">python-musicpd</code>というモジュールです(数年前に更新がストップしていますが使うには問題ないです)。これはクライアントというよりはラッパーのようなものなので、<code class=\"language-text\">mpc</code>よりも柔軟に機能を呼び出せそうです。  </p>\n<h2>Rofi-mpd-client</h2>\n<p>で、実際できたものがこちらです。<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/904792b31622f558c5a12c83d2ab7606/b03a8/rofi-mpd0.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.43717549325026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHLqWQD/8QAFRABAQAAAAAAAAAAAAAAAAAAECH/2gAIAQEAAQUCj//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABUQAQEAAAAAAAAAAAAAAAAAABAx/9oACAEBAAY/Ao//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAQMVH/2gAIAQEAAT8hJ4QpZX//2gAMAwEAAgADAAAAEHQf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAAIDAQAAAAAAAAAAAAAAASFRABARQf/aAAgBAQABPxAycaLcUwBfK1//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"rofi-mpd-client-top\"\n        title=\"rofi-mpd-client-top\"\n        src=\"/static/904792b31622f558c5a12c83d2ab7606/1c72d/rofi-mpd0.jpg\"\n        srcset=\"/static/904792b31622f558c5a12c83d2ab7606/a80bd/rofi-mpd0.jpg 148w,\n/static/904792b31622f558c5a12c83d2ab7606/1c91a/rofi-mpd0.jpg 295w,\n/static/904792b31622f558c5a12c83d2ab7606/1c72d/rofi-mpd0.jpg 590w,\n/static/904792b31622f558c5a12c83d2ab7606/a8a14/rofi-mpd0.jpg 885w,\n/static/904792b31622f558c5a12c83d2ab7606/b03a8/rofi-mpd0.jpg 963w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0d0c481c1788bd7252d196fc45de9d23/a9e43/rofi-mpd2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.780082987551864%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHLgsqD/8QAFRABAQAAAAAAAAAAAAAAAAAAECH/2gAIAQEAAQUCj//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABkQAAIDAQAAAAAAAAAAAAAAAAEhABARUf/aAAgBAQABPyEniLFX/9oADAMBAAIAAwAAABAEH//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQACAgMAAAAAAAAAAAAAAAEAESExQWHR/9oACAEBAAE/EAhnT2eRu0A3zHc//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"rofi-mpd-client-artist\"\n        title=\"rofi-mpd-client-artist\"\n        src=\"/static/0d0c481c1788bd7252d196fc45de9d23/1c72d/rofi-mpd2.jpg\"\n        srcset=\"/static/0d0c481c1788bd7252d196fc45de9d23/a80bd/rofi-mpd2.jpg 148w,\n/static/0d0c481c1788bd7252d196fc45de9d23/1c91a/rofi-mpd2.jpg 295w,\n/static/0d0c481c1788bd7252d196fc45de9d23/1c72d/rofi-mpd2.jpg 590w,\n/static/0d0c481c1788bd7252d196fc45de9d23/a8a14/rofi-mpd2.jpg 885w,\n/static/0d0c481c1788bd7252d196fc45de9d23/a9e43/rofi-mpd2.jpg 964w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0d0c481c1788bd7252d196fc45de9d23/a9e43/rofi-mpd2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.780082987551864%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHLgsqD/8QAFRABAQAAAAAAAAAAAAAAAAAAECH/2gAIAQEAAQUCj//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABkQAAIDAQAAAAAAAAAAAAAAAAEhABARUf/aAAgBAQABPyEniLFX/9oADAMBAAIAAwAAABAEH//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQACAgMAAAAAAAAAAAAAAAEAESExQWHR/9oACAEBAAE/EAhnT2eRu0A3zHc//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"rofi-mpd-client-album\"\n        title=\"rofi-mpd-client-album\"\n        src=\"/static/0d0c481c1788bd7252d196fc45de9d23/1c72d/rofi-mpd2.jpg\"\n        srcset=\"/static/0d0c481c1788bd7252d196fc45de9d23/a80bd/rofi-mpd2.jpg 148w,\n/static/0d0c481c1788bd7252d196fc45de9d23/1c91a/rofi-mpd2.jpg 295w,\n/static/0d0c481c1788bd7252d196fc45de9d23/1c72d/rofi-mpd2.jpg 590w,\n/static/0d0c481c1788bd7252d196fc45de9d23/a8a14/rofi-mpd2.jpg 885w,\n/static/0d0c481c1788bd7252d196fc45de9d23/a9e43/rofi-mpd2.jpg 964w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>一番上はrofiおなじみの検索バーです。インクリメンタルサーチ可能です。<br>\n2列目は今再生している曲を表示します。またプレイリストにおける現在の位置も最後尾に表示します。<br>\nそして選択リストでは、再生/停止コマンドと曲をプレイリストに追加します。私の環境ではアーティスト名/アルバム名/のようなフォルダ構造にしているので、MPDのインデックスにおけるrootの場所では追加できないようにしています。<br>\n一応アルバムを選択すると曲まで表示しますが、曲を選択してもそれに対しては未実装なので何も起きません。  </p>\n<p>これCLIファイラーのように見えますが、rofiなのでなにか選択する毎に一旦rofiは終了します。そして再び立ち上がる、といった動作をするのでチカチカします。</p>\n<h2>メモ</h2>\n<p>フォルダ間を遷移させるためにrofiを何回も起動させなければいけなかったので、</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">while</span> <span class=\"token number\">1</span>\n    rofi<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>みたいに書いていたら、rofiが終了できなくなって詰みかけました。(rofiが最前面に表示され、rofiへの入力が最優先される仕様上、いかなるキーのタイプを受け付けないのが理由です)<br>\n対策としてrofiから返ってくる要素がない場合whileループから脱出するようにしました。つまりEscキーを押せばrofiはなんの要素も選択されることなく終了するので、rofiの無限ループは起こりません。  </p>","frontmatter":{"title":"Rofiを使って簡単なMPDクライアントを作った","date":"September 06, 2018","description":null}}},"pageContext":{"slug":"/2018/180906_rofi-mpd-client/180906_rofi-mpd-client/","previous":{"fields":{"slug":"/2018/180831_qutebrowser/180831_qutebrowser/"},"frontmatter":{"title":"qutebrowserをインストール"}},"next":{"fields":{"slug":"/2018/180911_pocket_for_qb/180911_pocket_for_qb/"},"frontmatter":{"title":"qutebrowser上でpocketへ保存する"}}}}}