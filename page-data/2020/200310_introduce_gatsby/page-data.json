{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020/200310_introduce_gatsby/","result":{"data":{"site":{"siteMetadata":{"title":"RINotes","siteUrl":"https://tonooo71.github.io"}},"markdownRemark":{"id":"47ee8818-662d-510c-aca4-d73d45ab8aa7","excerpt":"このブログはもともと静的サイトジェネレータのHugoを用いて生成したページをGitHub Pagesを利用して公開していたのですが、\n2020年になって久しぶりに更新しようかなと思ったところ、すっかりHugoの使い方を忘れてしまっていました。 そういう理由に加え、また仕事柄React…","html":"<p>このブログはもともと静的サイトジェネレータのHugoを用いて生成したページをGitHub Pagesを利用して公開していたのですが、\n2020年になって久しぶりに更新しようかなと思ったところ、すっかりHugoの使い方を忘れてしまっていました。<br>\nそういう理由に加え、また仕事柄Reactを使用するようになったこともあり、せっかくなら新しい静的サイトジェネレータに移行しようかなと思った次第です。  </p>\n<h2>Gatsbyとは</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/580269e30dd10d18bd6fac53dbde498f/c549b/gatsby_icon.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABG0lEQVQY03VQTUuEUBT1V7YNEgQRceG2RRjVWsxhsqIw20WaCLUIp0UJRhZt7AMKCwYHxBbjC0fe800vnTEx5iwe57577r2HQ00rYIyneE4W4H+LahgsUA4mHR2eo/3flFTNRp/puX5ztnN1P3iqG3EcAwDa0jRNEULdyyUqL468Lfpgdam3sbIfv30FD3eSJDmOkyRJGIamaZJJVVWDIMiyjHAI4Ww4/y5Oe+7J9uX68u7emjl8SXXj0DCORVHkOI5hGJqmeZ5nWZZwQRBkWa4dzWw/Xr9a/YG+6Zh9F07QOBtrmuZ5nuu6tm2T48SFZVmkVBTF9/1fv2X5F9jHcxzevuegqLYuDDyKotpzK23cFZFsygo1ad52+D+IualjDRv2twAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"GatsbyIcon\"\n        title=\"GatsbyIcon\"\n        src=\"/static/580269e30dd10d18bd6fac53dbde498f/fcda8/gatsby_icon.png\"\n        srcset=\"/static/580269e30dd10d18bd6fac53dbde498f/12f09/gatsby_icon.png 148w,\n/static/580269e30dd10d18bd6fac53dbde498f/e4a3f/gatsby_icon.png 295w,\n/static/580269e30dd10d18bd6fac53dbde498f/fcda8/gatsby_icon.png 590w,\n/static/580269e30dd10d18bd6fac53dbde498f/efc66/gatsby_icon.png 885w,\n/static/580269e30dd10d18bd6fac53dbde498f/c83ae/gatsby_icon.png 1180w,\n/static/580269e30dd10d18bd6fac53dbde498f/c549b/gatsby_icon.png 2128w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>GatsbyはReactをベースにした静的サイトジェネレータです。<br>\n静的サイトジェネレータという名の通り、事前にビルドを行うことによりhtmlファイルとjavascriptファイルを生成します。<br>\n通常のReactも同じようにビルドしているじゃないかと思ったのですが、Reactではよくバンドルされたjavascriptファイル(とcssファイル)が生成されるのに対し、Gatsbyは基本的にhtmlファイルを生成します。<br>\nここが静的サイトジェネレータと言われる所以だと思います。<br>\n一方Reactをベースにしているので、記述方法はjsxですし、なんならjavascriptでロジックを書くことも可能です。  </p>\n<h2>じゃあGatsbyの利点って?</h2>\n<p>ReactによるSPA(Single Page Application)に比べて何がいいの?という疑問に対しては、SPAでごりごりロジックを入れたページを作りたいのでなければ圧倒的に速度が出るというのが静的サイトジェネレータであるGatsbyの利点かなと思います。<br>\n(このブログもやろうと思えばReactとReact-Routerを使ってSPAで作れなくもないですが…)<br>\nまた、Gatsbyが用意しているLinkコンポーネントを利用することで、ページ内にリンクがあればプリフェッチしてくれるので高速にリンク先に遷移できることもメリットです。  </p>\n<h2>HugoからGatsbyへの移行</h2>\n<h3>スターターセットを用いたGatsbyの導入</h3>\n<p>本題に入ります。<br>\nGatsbyの導入方法はいろいろありますが、自分はもともとHugoを使っていた際に記事をMarkdownファイルとして書いていたこともあり、Markdownファイルを殆どそのまま流用できる<a href=\"https://www.gatsbyjs.org/starters/gatsbyjs/gatsby-starter-blog/\">gatsby-starter-blog</a>というスターターセットを利用して導入しました。<br>\nスターターセットとは、言わば予め必要そうなモジュールの導入や設定が施されたテンプレートのようなものです。\n上記のgatsby-starter-blogはその名の通り、ブログ向けのスターターセットになります。  </p>\n<p>まずターミナルで以下のコマンドを打ちます。(hogehogeはGatsbyにより構築されるファイル群が含まれるフォルダ名となります)  </p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">gatsby new hogehoge https://github.com/gatsbyjs/gatsby-starter-blog</code></pre></div>\n<p>次に<code class=\"language-text\">hogehoge</code>に移動して、<code class=\"language-text\">gatsby develop</code>を実行します。<br>\nそしてlocalhost:8000に移動すると、初期ページが表示されるはずです。  </p>\n<h3>Gatsbyのフォルダ構造</h3>\n<p>gatsby-starter-blogにより導入したGatsbyのフォルダ内の構造について見ていきます。  </p>\n<h4><code class=\"language-text\">content</code>フォルダ</h4>\n<p>ここには、サイト全体のリソースファイル(画像とか)がある<code class=\"language-text\">assets</code>フォルダと、Markdownで書かれたブログの記事が配置される<code class=\"language-text\">blog</code>フォルダがあります。<br>\n<code class=\"language-text\">blog</code>フォルダ以下にMarkdownで記事を書き保存することで、ビルド時にgatsby-source-filesystemプラグインによりデータベース化され、それをもとにhtmlファイルが生成されます。<br>\n因みに<code class=\"language-text\">blog</code>フォルダ以下のツリー構造はそのままサイトのURLに反映されます。<br>\n例えばこの記事のURLは<code class=\"language-text\">https://tonooo71.github.io/2020/200314_introduce_gatsby/</code>ですが、記事自体は<code class=\"language-text\">blog/2020/200314_introduce_gatsby/</code>フォルダ内にあるindex.mdとgatsby_icon.pngから構成されています。<br>\nどのフォルダをコンテンツのソースとするかは<code class=\"language-text\">gatsby-config.js</code>に書かれてあるので、他にコンテンツソースフォルダを作りたいとなったときはここを編集する必要があります。<br>\nもともとサンプルの記事があるので、Hugoで書いていたMarkdownファイルもそれを参考に少し書き換えました。<br>\nとは言っても最初に書くメタデータの書式以外は同じMarkdownファイルなので、殆どそのまま利用できるのではないかと思います。  </p>\n<h4><code class=\"language-text\">public</code>フォルダ</h4>\n<p>このフォルダは<code class=\"language-text\">yarn build</code>でビルドした際に生成されるサイトのソースが保存されます。<br>\nこのフォルダ内のものをサーバーにアップロードする必要があります。  </p>\n<h4><code class=\"language-text\">src</code>フォルダ</h4>\n<p><code class=\"language-text\">components</code>フォルダには、ウェブサイト共通のページの外観(layout.js)や記事一覧ページなどに表示されるブログ記事へのリンク要素(page.js)、著者を表示する要素(bio.js)などが書かれたReactコンポーネントが保存されています。<br>\n<code class=\"language-text\">pages</code>フォルダには、トップページの外観(index.js)や404ページの外観(404.js)が書かれたReactコンポーネントがあります。<br>\n<code class=\"language-text\">templates</code>フォルダには、ブログ記事ページのテンプレートとなるblog-post.jsがあり、ここにデータベースから記事の内容を流し込むことでHTML化された記事ページが生成されます。<br>\nいずれもJSXファイルなので、Reactに慣れている人であれば理解しやすいとは思います。  </p>\n<h4>その他</h4>\n<p>rootディレクトリ内のgatsby-browser.jsやgatsby-config.js、gatsby-node.jsはプラグインの導入やページの生成の際に変更するものです。<br>\n後々機能を追加していったりする際には編集必須です。(未だに全部はよくわかっていないのですが)</p>\n<h3>スクリプト</h3>\n<p>Hugoはデフォルトでデプロイのためのスクリプトが用意されていたように思いますが、Gatsbyには予め用意されていないので作成してみました。  </p>\n<p>以下は、ビルドを行い<code class=\"language-text\">public</code>フォルダ内のファイルをgithubioフォルダにコピーし、リモートリポジトリoriginに対しpushするスクリプトです。  </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token function\">yarn</span> clean\n<span class=\"token function\">yarn</span> build\n\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span>\n\n<span class=\"token assign-left variable\">msg</span><span class=\"token operator\">=</span><span class=\"token string\">\"rebuilding site <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">date</span><span class=\"token variable\">`</span></span>\"</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$#</span> -eq <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">then</span> <span class=\"token assign-left variable\">msg</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span>\n<span class=\"token keyword\">fi</span>\n<span class=\"token function\">git</span> commit -m <span class=\"token string\">\"<span class=\"token variable\">$msg</span>\"</span>\n\n<span class=\"token function\">git</span> push origin master\n\n<span class=\"token builtin class-name\">cd</span> <span class=\"token punctuation\">..</span>/githubio\n\n<span class=\"token function\">git</span> pull origin master\n<span class=\"token function\">cp</span> -r <span class=\"token punctuation\">..</span>/blog/public/* ./\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token function\">git</span> commit -m <span class=\"token string\">\"<span class=\"token variable\">$msg</span>\"</span>\n<span class=\"token function\">git</span> push origin master</code></pre></div>\n<p>他にも、新規記事を作成するスクリプトなんかも作っておけば便利かもしれません。  </p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> datetime\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> sys\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">new_blog</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    now <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>datetime<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    year <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>now<span class=\"token punctuation\">.</span>year<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n    month <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>now<span class=\"token punctuation\">.</span>month<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">.</span>zfill<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    day <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>now<span class=\"token punctuation\">.</span>day<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">.</span>zfill<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    os<span class=\"token punctuation\">.</span>mkdir<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"./content/blog/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>year<span class=\"token punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>year<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token format-spec\">]</span><span class=\"token punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>month<span class=\"token punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>day<span class=\"token punctuation\">}</span></span><span class=\"token string\">_</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"./content/blog/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>year<span class=\"token punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>year<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token format-spec\">]</span><span class=\"token punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>month<span class=\"token punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>day<span class=\"token punctuation\">}</span></span><span class=\"token string\">_</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span></span><span class=\"token string\">/index.md\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"w\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> lines<span class=\"token punctuation\">:</span>\n        lines<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">\"---\\n\"</span><span class=\"token punctuation\">)</span>\n        lines<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">\"title: \\n\"</span><span class=\"token punctuation\">)</span>\n        lines<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"date: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>now<span class=\"token punctuation\">.</span>isoformat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\\n\"</span></span><span class=\"token punctuation\">)</span>\n        lines<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">\"description: \\n\"</span><span class=\"token punctuation\">)</span>\n        lines<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">\"---\\n\"</span><span class=\"token punctuation\">)</span>\n        lines<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    new_blog<span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>終わりに</h3>\n<p>今回の記事は以上です。<br>\n次はデフォルトではブログとしては少し機能不足なので、そのあたりについてかいていければと思います。  </p>","frontmatter":{"title":"Gatsbyの導入","date":"March 10, 2020","description":"ブログの生成をHugoからGatsbyに変更しました","tags":"React Gatsby"}}},"pageContext":{"slug":"/2020/200310_introduce_gatsby/","previous":{"fields":{"slug":"/2020/200301_reacthooks-dropdownmenu/"},"frontmatter":{"title":"React+Hookで作るメニュー外クリックで閉じるドロップダウンメニュー","tags":"React"}},"next":null}}}