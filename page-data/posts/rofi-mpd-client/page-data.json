{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/rofi-mpd-client","result":{"data":{"markdownRemark":{"id":"76ffac6d-a7c9-5c3d-a7b3-602ed0c02b8b","html":"<p>タイトルのとおり。<br>\nRepository: <a href=\"https://github.com/tonooo71/rofi-mpd-client\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">rofi-mpd-client</a></p>\n<h2 id=\"rofi\" style=\"position:relative;\"><a href=\"#rofi\" aria-label=\"rofi permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rofi</h2>\n<p>rofi は i3 のようなタイル型ウィンドウマネージャーでよく用いられているランチャーです。<br>\n基本的な動作としては、選びたい項目を rofi に渡すとリストとして表示され、選択した項目(の文字列)を返すといったものです。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9151117112fbd6f7cc69e9511ed216c4/b17f8/2018-09-06-screenshot180906.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAEDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHMgQuF/8QAGBAAAwEBAAAAAAAAAAAAAAAAAQIQEQD/2gAIAQEAAQUC7YYqjP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AVf/xAAVEAEBAAAAAAAAAAAAAAAAAAAgMf/aAAgBAQAGPwKr/8QAHBAAAgICAwAAAAAAAAAAAAAAAAERITFBUXGR/9oACAEBAAE/IZb29OzJfLKMWRiyP//aAAwDAQACAAMAAAAQBA//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxBX/8QAFREBAQAAAAAAAAAAAAAAAAAAAAH/2gAIAQIBAT8QWH//xAAdEAEAAgAHAAAAAAAAAAAAAAABABExUaHB0eHw/9oACAEBAAE/EBze81ivfMO4gFDCAaMbNjebP//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9151117112fbd6f7cc69e9511ed216c4/8ac56/2018-09-06-screenshot180906.webp 240w,\n/static/9151117112fbd6f7cc69e9511ed216c4/d3be9/2018-09-06-screenshot180906.webp 480w,\n/static/9151117112fbd6f7cc69e9511ed216c4/e46b2/2018-09-06-screenshot180906.webp 960w,\n/static/9151117112fbd6f7cc69e9511ed216c4/f992d/2018-09-06-screenshot180906.webp 1440w,\n/static/9151117112fbd6f7cc69e9511ed216c4/fad48/2018-09-06-screenshot180906.webp 1600w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9151117112fbd6f7cc69e9511ed216c4/09b79/2018-09-06-screenshot180906.jpg 240w,\n/static/9151117112fbd6f7cc69e9511ed216c4/7cc5e/2018-09-06-screenshot180906.jpg 480w,\n/static/9151117112fbd6f7cc69e9511ed216c4/6a068/2018-09-06-screenshot180906.jpg 960w,\n/static/9151117112fbd6f7cc69e9511ed216c4/644c5/2018-09-06-screenshot180906.jpg 1440w,\n/static/9151117112fbd6f7cc69e9511ed216c4/b17f8/2018-09-06-screenshot180906.jpg 1600w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9151117112fbd6f7cc69e9511ed216c4/6a068/2018-09-06-screenshot180906.jpg\"\n            alt=\"Screenshot180906\"\n            title=\"Screenshot180906\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>よく使われているのは上のようにプログラムを選択するランチャーとしてですが、上記のように入力を手動で与えることができるので、色々活用方法が考えられます。<br>\n実際に rofi の wiki ページにはユーザーが作成したスクリプトがいくつか紹介されています。(<a href=\"https://github.com/DaveDavenport/rofi/wiki/User-scripts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">User scripts</a>)</p>\n<p>今回作った MPD のクライアントも 2 つ紹介されているのですが、自分がよく使う機能だったり欲しい機能だったりがなかったりしたので、作ってみることにしました。<br>\n最初は例のごとくシェルスクリプトで作ろうと思ったのですが、挫折したのでおとなしく python3 で記述しました。<br>\nMPD へアクセスするために上記のスクリプトではいずれも<code class=\"language-text\">mpc</code>という CLI クライアントを利用していたのですが、いちいち subprocess モジュールで呼び出すのもなんかなあって感じだったので、Python のモジュールないか探していたらありました。<br>\n<code class=\"language-text\">python-musicpd</code>というモジュールです(数年前に更新がストップしていますが使うには問題ないです)。これはクライアントというよりはラッパーのようなものなので、<code class=\"language-text\">mpc</code>よりも柔軟に機能を呼び出せそうです。</p>\n<h2 id=\"rofi-mpd-client\" style=\"position:relative;\"><a href=\"#rofi-mpd-client\" aria-label=\"rofi mpd client permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rofi-mpd-client</h2>\n<p>で、実際できたものがこちらです。<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/904792b31622f558c5a12c83d2ab7606/b03a8/2018-09-06-rofi-mpd0.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAcqFkB//xAAWEAADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQEAAQUCof8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFRABAQAAAAAAAAAAAAAAAAAAEDH/2gAIAQEABj8Cj//EABkQAAIDAQAAAAAAAAAAAAAAAAERABAxUf/aAAgBAQABPyE8EKWV/9oADAMBAAIAAwAAABD0H//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABoQAQACAwEAAAAAAAAAAAAAAAEhUQAQEUH/2gAIAQEAAT8Q7IaLcUwBfK1//9k='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/904792b31622f558c5a12c83d2ab7606/8ac56/2018-09-06-rofi-mpd0.webp 240w,\n/static/904792b31622f558c5a12c83d2ab7606/d3be9/2018-09-06-rofi-mpd0.webp 480w,\n/static/904792b31622f558c5a12c83d2ab7606/e46b2/2018-09-06-rofi-mpd0.webp 960w,\n/static/904792b31622f558c5a12c83d2ab7606/095e2/2018-09-06-rofi-mpd0.webp 963w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/904792b31622f558c5a12c83d2ab7606/09b79/2018-09-06-rofi-mpd0.jpg 240w,\n/static/904792b31622f558c5a12c83d2ab7606/7cc5e/2018-09-06-rofi-mpd0.jpg 480w,\n/static/904792b31622f558c5a12c83d2ab7606/6a068/2018-09-06-rofi-mpd0.jpg 960w,\n/static/904792b31622f558c5a12c83d2ab7606/b03a8/2018-09-06-rofi-mpd0.jpg 963w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/904792b31622f558c5a12c83d2ab7606/6a068/2018-09-06-rofi-mpd0.jpg\"\n            alt=\"rofi-mpd-client-top\"\n            title=\"rofi-mpd-client-top\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0d0c481c1788bd7252d196fc45de9d23/a9e43/2018-09-06-rofi-mpd2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHLgsqD/8QAFRABAQAAAAAAAAAAAAAAAAAAECH/2gAIAQEAAQUCj//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABkQAAEFAAAAAAAAAAAAAAAAAAEAEBEhUf/aAAgBAQABPyEnCqG//9oADAMBAAIAAwAAABAEH//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQACAgMAAAAAAAAAAAAAAAEAESExYaHh/9oACAEBAAE/EMar3z5FeIDfUdz/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0d0c481c1788bd7252d196fc45de9d23/8ac56/2018-09-06-rofi-mpd2.webp 240w,\n/static/0d0c481c1788bd7252d196fc45de9d23/d3be9/2018-09-06-rofi-mpd2.webp 480w,\n/static/0d0c481c1788bd7252d196fc45de9d23/e46b2/2018-09-06-rofi-mpd2.webp 960w,\n/static/0d0c481c1788bd7252d196fc45de9d23/6bfb6/2018-09-06-rofi-mpd2.webp 964w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0d0c481c1788bd7252d196fc45de9d23/09b79/2018-09-06-rofi-mpd2.jpg 240w,\n/static/0d0c481c1788bd7252d196fc45de9d23/7cc5e/2018-09-06-rofi-mpd2.jpg 480w,\n/static/0d0c481c1788bd7252d196fc45de9d23/6a068/2018-09-06-rofi-mpd2.jpg 960w,\n/static/0d0c481c1788bd7252d196fc45de9d23/a9e43/2018-09-06-rofi-mpd2.jpg 964w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0d0c481c1788bd7252d196fc45de9d23/6a068/2018-09-06-rofi-mpd2.jpg\"\n            alt=\"rofi-mpd-client-artist\"\n            title=\"rofi-mpd-client-artist\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0d0c481c1788bd7252d196fc45de9d23/a9e43/2018-09-06-rofi-mpd2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHLgsqD/8QAFRABAQAAAAAAAAAAAAAAAAAAECH/2gAIAQEAAQUCj//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABkQAAEFAAAAAAAAAAAAAAAAAAEAEBEhUf/aAAgBAQABPyEnCqG//9oADAMBAAIAAwAAABAEH//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQACAgMAAAAAAAAAAAAAAAEAESExYaHh/9oACAEBAAE/EMar3z5FeIDfUdz/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0d0c481c1788bd7252d196fc45de9d23/8ac56/2018-09-06-rofi-mpd2.webp 240w,\n/static/0d0c481c1788bd7252d196fc45de9d23/d3be9/2018-09-06-rofi-mpd2.webp 480w,\n/static/0d0c481c1788bd7252d196fc45de9d23/e46b2/2018-09-06-rofi-mpd2.webp 960w,\n/static/0d0c481c1788bd7252d196fc45de9d23/6bfb6/2018-09-06-rofi-mpd2.webp 964w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0d0c481c1788bd7252d196fc45de9d23/09b79/2018-09-06-rofi-mpd2.jpg 240w,\n/static/0d0c481c1788bd7252d196fc45de9d23/7cc5e/2018-09-06-rofi-mpd2.jpg 480w,\n/static/0d0c481c1788bd7252d196fc45de9d23/6a068/2018-09-06-rofi-mpd2.jpg 960w,\n/static/0d0c481c1788bd7252d196fc45de9d23/a9e43/2018-09-06-rofi-mpd2.jpg 964w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0d0c481c1788bd7252d196fc45de9d23/6a068/2018-09-06-rofi-mpd2.jpg\"\n            alt=\"rofi-mpd-client-album\"\n            title=\"rofi-mpd-client-album\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>一番上は rofi おなじみの検索バーです。インクリメンタルサーチ可能です。<br>\n2 列目は今再生している曲を表示します。またプレイリストにおける現在の位置も最後尾に表示します。<br>\nそして選択リストでは、再生/停止コマンドと曲をプレイリストに追加します。私の環境ではアーティスト名/アルバム名/のようなフォルダ構造にしているので、MPD のインデックスにおける root の場所では追加できないようにしています。<br>\n一応アルバムを選択すると曲まで表示しますが、曲を選択してもそれに対しては未実装なので何も起きません。</p>\n<p>これ CLI ファイラーのように見えますが、rofi なのでなにか選択する毎に一旦 rofi は終了します。そして再び立ち上がる、といった動作をするのでチカチカします。</p>\n<h2 id=\"メモ\" style=\"position:relative;\"><a href=\"#%E3%83%A1%E3%83%A2\" aria-label=\"メモ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>メモ</h2>\n<p>フォルダ間を遷移させるために rofi を何回も起動させなければいけなかったので、</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">while</span> <span class=\"token number\">1</span>\n    rofi<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>みたいに書いていたら、rofi が終了できなくなって詰みかけました。(rofi が最前面に表示され、rofi への入力が最優先される仕様上、いかなるキーのタイプを受け付けないのが理由です)<br>\n対策として rofi から返ってくる要素がない場合 while ループから脱出するようにしました。つまり Esc キーを押せば rofi はなんの要素も選択されることなく終了するので、rofi の無限ループは起こりません。</p>","fields":{"slug":"/posts/rofi-mpd-client","tagSlugs":["/tag/linux/","/tag/i-3-wm/"]},"frontmatter":{"date":"2018-09-06T16:54:40+09:00","description":null,"tags":["Linux","i3wm"],"title":"Rofiを使って簡単なMPDクライアントを作った","socialImage":null}}},"pageContext":{"slug":"/posts/rofi-mpd-client"}},"staticQueryHashes":["251939775","401334301","825871152"]}