{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/virtualbox-vkms","result":{"data":{"markdownRemark":{"id":"13034d49-1f47-5991-85c7-7a46251cb4de","html":"<p>今は Windows10 と Arch Linux とのデュアルブートをしていてメインでは Linux 使っているんだけど、どうしても Windows 使いたい場合があって(Office とか Office とか Office とか)<br>\nこれまでは Linux 側で VirtualBox に Windows を入れて使っていたんだけど、何分容量が少ないノート PC を使っているから実質トリプルブートになるこのやりかたは厳しいものがあった<br>\nそこでデュアルブートをしている実パーティションの Windows を Linux 側から呼び出せばいいんじゃないかと思って調べてみたらなんかできそうだったのでやってみた</p>\n<p>結論から言うとできたけどちょっと問題がいろいろ起きてやっぱやめようってなってしまったが…</p>\n<h3 id=\"やったこと\" style=\"position:relative;\"><a href=\"#%E3%82%84%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\" aria-label=\"やったこと permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>やったこと</h3>\n<p>基本的には<a href=\"https://wiki.archlinux.jp/index.php/VirtualBox/%E3%83%92%E3%83%B3%E3%83%88%E3%81%A8%E3%83%86%E3%82%AF%E3%83%8B%E3%83%83%E3%82%AF#Windows_.E3.81.AE.E3.83.91.E3.83.BC.E3.83.86.E3.82.A3.E3.82.B7.E3.83.A7.E3.83.B3.E3.82.92_VirtualBox_.E3.81.A7.E8.B5.B7.E5.8B.95\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ArchWiki</a>に則ってやった<br>\n手順としては、</p>\n<ul>\n<li>自分のユーザーをグループ<code class=\"language-text\">disk</code>と<code class=\"language-text\">vboxusers</code>に追加</li>\n<li>ArchWiki の通り udev を設定</li>\n<li>仮想ディスクイメージファイルを作成</li>\n<li>VirtualBox の設定</li>\n</ul>\n<p>ディスクイメージファイル作成はちょっと詰まった<br>\n自分のディスク構成は、</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ fdisk -l\nDisk /dev/nvme0n1: 238.5 GiB, 256060514304 bytes, 500118192 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: gpt\nDisk identifier: 06321AVC-9994-4055-9FFF-F62FFC20193E\n\nDevice             Start       End   Sectors   Size Type\n/dev/nvme0n1p1      2048    206847    204800   100M EFI System\n/dev/nvme0n1p2    206848    239615     32768    16M Microsoft reserved\n/dev/nvme0n1p3    239616 168017419 167777804    80G Microsoft basic data\n/dev/nvme0n1p4 168017920 496429055 328411136 156.6G Microsoft basic data\n/dev/nvme0n1p5 496431104 500117503   3686400   1.8G Windows recovery environment</code></pre></div>\n<p>ってなっているんだけど(nvme0n1p3 が Windows10、nvme0n1p4 が Arch Linux)、Wiki の通りにやると UEFI シェルが出てきてどうにもなんなくなってしまう(できるのかもしれないけどよくわからん)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ vboxmanage internalcommands createrawvmdk -filename /path/to/vm/folder/windows.vmdk -rawdisk /dev/nvme0n1 -partitions 2,3 -relative</code></pre></div>\n<p>なのでブートローダーがある領域まで突っ込めばなんとかなるんじゃないかと思ってやってみた</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ vboxmanage internalcommands createrawvmdk -filename /path/to/vm/folder/windows.vmdk -rawdisk /dev/nvme0n1 -partitions 1,2,3 -relative</code></pre></div>\n<p>すると起動成功(systemd-boot から始まってしまうのでそこで Windows 選択する必要が出たが)<br>\n普通に使えるしいいじゃん、ディスク容量も節約できるし</p>\n<h3 id=\"やったぜ\" style=\"position:relative;\"><a href=\"#%E3%82%84%E3%81%A3%E3%81%9F%E3%81%9C\" aria-label=\"やったぜ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>やったぜ</h3>\n<p>って思ってたけど大きな問題点が 2 つ出た</p>\n<p>1 つは VirtualBox で起動させると Windows のライセンス認証が通らない、通ってない状態になる<br>\nなので普通に Windows 起動させたときにライセンス認証いちいちする必要が出てきてしまう<br>\n(Wiki には設定で Hyper-V をオンにするとライセンス問題回避できるかもね、って書いてあるけど自分は無理でした)<br>\nあと Office のライセンス認証も通らなかった</p>\n<p>これより面倒な問題あって、VirtualBox で Windows を起動したあと普通に Windows を起動させて終了させるとなぜかブートローダーの順序が変わってしまうのに気がついた<br>\nつまりいつもは Linux の systemd-boot を使っているんだけど、なぜか Windows のブートローダーが優先順位高く変更されてしまい、Linux が起動できなくなってしまう(いちいち BIOS 設定で変更しないといけなくなってしまった)</p>\n<p>そこまでして実パーティションの Windows を呼び出して使うか…となってしまったので、結局元通り VirtualBox 上にインストールして今は使ってる</p>\n<h3 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h3>\n<ul>\n<li><a href=\"https://www.ncaq.net/2018/01/31/17/12/33/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">デュアルブートしている環境で VirtualBox でホスト OS を Linux とし Windows をゲスト OS として起動する</a></li>\n<li><a href=\"https://medium.com/@matsu_hiroshi/%E5%AE%9F%E7%9B%B8%E3%82%92%E4%BB%AE%E6%83%B3%E7%9A%84%E3%81%AB%E7%AA%93%E9%96%8B%E3%81%8F%E3%81%93%E3%81%A8-e37ae0c61ebf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">実相を仮想的に窓開くこと</a></li>\n<li><a href=\"https://wiki.archlinux.jp/index.php/VirtualBox/%E3%83%92%E3%83%B3%E3%83%88%E3%81%A8%E3%83%86%E3%82%AF%E3%83%8B%E3%83%83%E3%82%AF#Windows_.E3.81.AE.E3.83.91.E3.83.BC.E3.83.86.E3.82.A3.E3.82.B7.E3.83.A7.E3.83.B3.E3.82.92_VirtualBox_.E3.81.A7.E8.B5.B7.E5.8B.95\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Windows のパーティションを VirtualBox で起動</a></li>\n</ul>","fields":{"slug":"/posts/virtualbox-vkms","tagSlugs":["/tag/linux/","/tag/arch-linux/"]},"frontmatter":{"date":"2018-08-02T08:33:02+09:00","description":"今はWindows10とArch LinuxとのデュアルブートをしていてメインではLinux使っているんだけど、どうしてもWindows使いたい場合がある","tags":["Linux","Arch Linux"],"title":"デュアルブートでVirtualBox","socialImage":null}}},"pageContext":{"slug":"/posts/virtualbox-vkms"}},"staticQueryHashes":["251939775","401334301","825871152"]}