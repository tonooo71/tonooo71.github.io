{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/ejdict-for-qb","result":{"data":{"markdownRemark":{"id":"99931af8-d2fc-5eef-b384-e8c108d50773","html":"<p>qutebrowser はアドオンが自由に追加できないのがあれだけど、<code class=\"language-text\">spawn</code>コマンドで簡単なものなら割とスクリプトで対応できるのが良い点<br>\n今回は<a href=\"https://qiita.com/wtetsu/items/c43232c6c44918e977c9\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">この記事</a>読んでそういえばポップアップの辞書ほしいな、と思ったので作ってみた<br>\nとはいってもポップアップの仕方とか Javascript とかわからないし、ものすごく単純なものだけど</p>\n<h2 id=\"用意するもの\" style=\"position:relative;\"><a href=\"#%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B%E3%82%82%E3%81%AE\" aria-label=\"用意するもの permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>用意するもの</h2>\n<p>先程の記事にもあったように ejdic-hand を使わせていただきます<br>\nまああんまり詳細なものだと表示しきれるか怪しいし、こんなもんでいいかなって…<br>\nejdic-hand は(ワード)(タブ)(説明)のように 1 行で 1 つのワードが書かれた txt ファイルです<br>\nなので python で読み込んでそのまま検索させます</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> sys\n\n\nword <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nus_dir <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'HOME'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'/.local/share/qutebrowser/userscripts'</span>\n\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>us_dir<span class=\"token operator\">+</span><span class=\"token string\">'/ejdict/EJDict/src/ejdic-hand-utf8.txt'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> lines<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> lines<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span>word<span class=\"token operator\">+</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n            sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>これだけだと少し使いづらいので、さらに追記します</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>us_dir<span class=\"token operator\">+</span><span class=\"token string\">'/ejdict/EJDict/src/ejdic-hand-utf8.txt'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> lines<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> lines<span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 複数形, 三人称単数形</span>\n        <span class=\"token keyword\">if</span> word<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'s'</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">break</span>\n        <span class=\"token keyword\">if</span> word<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'es'</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">break</span>\n        <span class=\"token comment\"># 進行形</span>\n        <span class=\"token keyword\">if</span> word<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'ing'</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">break</span>\n        <span class=\"token comment\"># 過去形</span>\n        <span class=\"token keyword\">if</span> word<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'d'</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">break</span>\n        <span class=\"token keyword\">if</span> word<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'ed'</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>まあ全てはカバーできないですが、基本的な変化をするワードについてはカバーできているはずです</p>\n<p>そしてこれをシェルスクリプトを通して実行します<br>\nシェルスクリプトを通す理由は、qutebrowser で userscript を実行した際に使用できる<a href=\"https://github.com/qutebrowser/qutebrowser/blob/master/doc/userscripts.asciidoc\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">変数</a>を python スクリプト内から利用する方法がわからなかったからです…</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token assign-left variable\">us_dir</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token environment constant\">$HOME</span>/.local/share/qutebrowser/userscripts\"</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$1</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"ejdict\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token assign-left variable\">word</span><span class=\"token operator\">=</span><span class=\"token string\">'\"'</span><span class=\"token variable\"><span class=\"token variable\">$(</span>python $us_dir/ejdict/ejdict.py $QUTE_SELECTED_TEXT<span class=\"token variable\">)</span></span><span class=\"token string\">'\"'</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$?</span> -eq <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"message-info <span class=\"token variable\">$word</span>\"</span> <span class=\"token operator\">>></span> <span class=\"token string\">\"<span class=\"token variable\">$QUTE_FIFO</span>\"</span>\n    <span class=\"token keyword\">else</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"message-error 'Cannot find <span class=\"token entity\" title=\"\\&quot;\">\\\"</span><span class=\"token variable\">$QUTE_SELECTED_TEXT</span><span class=\"token entity\" title=\"\\&quot;\">\\\"</span> in a dictionary'\"</span> <span class=\"token operator\">>></span> <span class=\"token string\">\"<span class=\"token variable\">$QUTE_FIFO</span>\"</span>\n    <span class=\"token keyword\">fi</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<p><code class=\"language-text\">$QUTE_SELECTED_TEXT</code>は選択したテキストを指します<br>\nこれで選択したワードを python スクリプトに渡し、返り値を qutebrowser の<code class=\"language-text\">message-info</code>を通して表示させます<br>\nこんな感じに表示されます</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8203a29140f7fd8325f496d0115d78df/b17f8/2018-09-12-screenshot_ejdict.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAUGAv/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAF3qdEohER//8QAGxAAAgMAAwAAAAAAAAAAAAAAAAEDBBECFEH/2gAIAQEAAQUC9xGIdmU7MxxsStf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAEBAQEAAAAAAAAAAAAAAAAAMjEB/9oACAEBAAY/AmcYtan/xAAcEAACAgIDAAAAAAAAAAAAAAAAAVGRESHR8PH/2gAIAQEAAT8hagqPIHAoyeCOxI2B6R//2gAMAwEAAgADAAAAEMw//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8Qqv/EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/EIr/xAAbEAACAgMBAAAAAAAAAAAAAAAAAREhMZHwYf/aAAgBAQABPxBbZTKMBR3qCTrSFathdQVK/XhIGnPFH//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8203a29140f7fd8325f496d0115d78df/8ac56/2018-09-12-screenshot_ejdict.webp 240w,\n/static/8203a29140f7fd8325f496d0115d78df/d3be9/2018-09-12-screenshot_ejdict.webp 480w,\n/static/8203a29140f7fd8325f496d0115d78df/e46b2/2018-09-12-screenshot_ejdict.webp 960w,\n/static/8203a29140f7fd8325f496d0115d78df/f992d/2018-09-12-screenshot_ejdict.webp 1440w,\n/static/8203a29140f7fd8325f496d0115d78df/fad48/2018-09-12-screenshot_ejdict.webp 1600w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8203a29140f7fd8325f496d0115d78df/09b79/2018-09-12-screenshot_ejdict.jpg 240w,\n/static/8203a29140f7fd8325f496d0115d78df/7cc5e/2018-09-12-screenshot_ejdict.jpg 480w,\n/static/8203a29140f7fd8325f496d0115d78df/6a068/2018-09-12-screenshot_ejdict.jpg 960w,\n/static/8203a29140f7fd8325f496d0115d78df/644c5/2018-09-12-screenshot_ejdict.jpg 1440w,\n/static/8203a29140f7fd8325f496d0115d78df/b17f8/2018-09-12-screenshot_ejdict.jpg 1600w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8203a29140f7fd8325f496d0115d78df/6a068/2018-09-12-screenshot_ejdict.jpg\"\n            alt=\"Screenshot ejdict\"\n            title=\"Screenshot ejdict\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><code class=\"language-text\">message-info</code>で表示する都合上、デフォルトの 2000ms では早すぎるはずなので 5000ms に変更しました<br>\nあとはバインドで e かなにかに設定すると、テキスト選択してキー押すだけで写真のように日本語訳が下に表示されるようになります</p>\n<p>使った感想としては、オフラインだからかかなり高速ですが辞書が弱いからかヒットしない語句もちらほら見受けられるのがちょっと気になりました</p>\n<h2 id=\"refference\" style=\"position:relative;\"><a href=\"#refference\" aria-label=\"refference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Refference</h2>\n<p><a href=\"https://github.com/tonooo71/qutebrowser-scripts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tonooo71/qutebrowser-scripts</a></p>","fields":{"slug":"/posts/ejdict-for-qb","tagSlugs":["/tag/linux/"]},"frontmatter":{"date":"2018-09-12T21:59:44+09:00","description":"スクリプトで対応させる","tags":["Linux"],"title":"qutebrowserで英和辞書を使う","socialImage":{"publicURL":"/static/8203a29140f7fd8325f496d0115d78df/2018-09-12-screenshot_ejdict.jpg"}}}},"pageContext":{"slug":"/posts/ejdict-for-qb"}},"staticQueryHashes":["251939775","401334301","825871152"]}