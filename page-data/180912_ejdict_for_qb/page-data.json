{"componentChunkName":"component---src-templates-blog-post-js","path":"/180912_ejdict_for_qb/","result":{"data":{"site":{"id":"Site","siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"40231a92-b831-5f1e-a5fb-727d715b21d3","excerpt":"qutebrowserはアドオンが自由に追加できないのがあれだけど、コマンドで簡単なものなら割とスクリプトで対応できるのが良い点 今回はこの記事読んでそういえばポップアップの辞書ほしいな、と思ったので作ってみた とはいってもポップアップの仕方とかJavascript…","html":"<p>qutebrowserはアドオンが自由に追加できないのがあれだけど、<code class=\"language-text\">spawn</code>コマンドで簡単なものなら割とスクリプトで対応できるのが良い点<br>\n今回は<a href=\"https://qiita.com/wtetsu/items/c43232c6c44918e977c9\">この記事</a>読んでそういえばポップアップの辞書ほしいな、と思ったので作ってみた<br>\nとはいってもポップアップの仕方とかJavascriptとかわからないし、ものすごく単純なものだけど  </p>\n<h2>用意するもの</h2>\n<p>先程の記事にもあったようにejdic-handを使わせていただきます<br>\nまああんまり詳細なものだと表示しきれるか怪しいし、こんなもんでいいかなって…<br>\nejdic-handは(ワード)(タブ)(説明)のように1行で1つのワードが書かれたtxtファイルです<br>\nなのでpythonで読み込んでそのまま検索させます  </p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> sys\n\n\nword <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nus_dir <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'HOME'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'/.local/share/qutebrowser/userscripts'</span>\n\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>us_dir<span class=\"token operator\">+</span><span class=\"token string\">'/ejdict/EJDict/src/ejdic-hand-utf8.txt'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> lines<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> lines<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span>word<span class=\"token operator\">+</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n            sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>これだけだと少し使いづらいので、さらに追記します</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>us_dir<span class=\"token operator\">+</span><span class=\"token string\">'/ejdict/EJDict/src/ejdic-hand-utf8.txt'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> lines<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> lines<span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 複数形, 三人称単数形</span>\n        <span class=\"token keyword\">if</span> word<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'s'</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">break</span>\n        <span class=\"token keyword\">if</span> word<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'es'</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">break</span>\n        <span class=\"token comment\"># 進行形</span>\n        <span class=\"token keyword\">if</span> word<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'ing'</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">break</span>\n        <span class=\"token comment\"># 過去形</span>\n        <span class=\"token keyword\">if</span> word<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'d'</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">break</span>\n        <span class=\"token keyword\">if</span> word<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'ed'</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>まあ全てはカバーできないですが、基本的な変化をするワードについてはカバーできているはずです  </p>\n<p>そしてこれをシェルスクリプトを通して実行します<br>\nシェルスクリプトを通す理由は、qutebrowserでuserscriptを実行した際に使用できる<a href=\"https://github.com/qutebrowser/qutebrowser/blob/master/doc/userscripts.asciidoc\">変数</a>をpythonスクリプト内から利用する方法がわからなかったからです…  </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token assign-left variable\">us_dir</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token environment constant\">$HOME</span>/.local/share/qutebrowser/userscripts\"</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$1</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"ejdict\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token assign-left variable\">word</span><span class=\"token operator\">=</span><span class=\"token string\">'\"'</span><span class=\"token variable\"><span class=\"token variable\">$(</span>python $us_dir/ejdict/ejdict.py $QUTE_SELECTED_TEXT<span class=\"token variable\">)</span></span><span class=\"token string\">'\"'</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$?</span> -eq <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"message-info <span class=\"token variable\">$word</span>\"</span> <span class=\"token operator\">>></span> <span class=\"token string\">\"<span class=\"token variable\">$QUTE_FIFO</span>\"</span>\n    <span class=\"token keyword\">else</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"message-error 'Cannot find <span class=\"token entity\" title=\"\\&quot;\">\\\"</span><span class=\"token variable\">$QUTE_SELECTED_TEXT</span><span class=\"token entity\" title=\"\\&quot;\">\\\"</span> in a dictionary'\"</span> <span class=\"token operator\">>></span> <span class=\"token string\">\"<span class=\"token variable\">$QUTE_FIFO</span>\"</span>\n    <span class=\"token keyword\">fi</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<p><code class=\"language-text\">$QUTE_SELECTED_TEXT</code>は選択したテキストを指します<br>\nこれで選択したワードをpythonスクリプトに渡し、返り値をqutebrowserの<code class=\"language-text\">message-info</code>を通して表示させます<br>\nこんな感じに表示されます  </p>\n<p>{{&#x3C; figure src=“/img/screenshot_ejdict.jpg” title=“Screenshot ejdict” class=“center” >}}</p>\n<p><code class=\"language-text\">message-info</code>で表示する都合上、デフォルトの2000msでは早すぎるはずなので5000msに変更しました<br>\nあとはバインドでeかなにかに設定すると、テキスト選択してキー押すだけで写真のように日本語訳が下に表示されるようになります  </p>\n<p>使った感想としては、オフラインだからかかなり高速ですが辞書が弱いからかヒットしない語句もちらほら見受けられるのがちょっと気になりました  </p>\n<h2>Refference</h2>\n<p><a href=\"https://github.com/tonooo71/qutebrowser-scripts\">tonooo71/qutebrowser-scripts</a></p>","frontmatter":{"title":"qutebrowserで英和辞書を使う","date":"September 12, 2018","description":null}}},"pageContext":{"slug":"/180912_ejdict_for_qb/","previous":{"fields":{"slug":"/180911_pocket_for_qb/"},"frontmatter":{"title":"qutebrowser上でpocketへ保存する"}},"next":{"fields":{"slug":"/181118_i3ipc-python/"},"frontmatter":{"title":"i3ipc-pythonを使う"}}}}}